@page "/"
@using Blazor.Extensions; 
@using Blazor.Extensions.Canvas
@using Blazor.Extensions.Canvas.Canvas2D;
@using FamilyShow.Lib.Net7;
@inject NavigationManager Navigation

<InputFile OnChange="@LoadFiles" single />

@code {
    private async Task LoadFiles(InputFileChangeEventArgs e)
    {
        MemoryStream ms = new MemoryStream();
        await e.File.OpenReadStream().CopyToAsync(ms);
        ms.Position = 0;
        new GedcomImport().Import(GlobalState.Instance.PeopleCollection, ms);
        GlobalState.Instance.SelectedPerson = GlobalState.Instance.PeopleCollection[2];

        IEnumerable<DiagramItem> families = new FamilyTreeCreator().CreateTree(GlobalState.Instance.PeopleCollection, GlobalState.Instance.SelectedPerson);

        Dictionary<int, List<Person>> dictionary = families.GroupBy(x => x.Generation)
                                                           .OrderBy(x => x.Key)
                                                           .ToDictionary(
                                                               k => k.Key,
                                                               v => v.SelectMany(x => x.Persons).ToList());
        Navigation.NavigateTo("/Counter");
    }
}
